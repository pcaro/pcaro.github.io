<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Pablo Caro" />
        <meta name="copyright" content="Pablo Caro" />

        <meta name="description" content="En mis proyectos suelo usar enlaces a elementos relacionados en el change_list del admin. utils.py Tengo esto en utils.py from django.contrib import admin from django.contrib.contenttypes.models import ContentType from django.core import urlresolvers from django.utils.datastructures import SortedDict from django.utils.functional import memoize ...
" />
        <meta name="twitter:creator" content="@pcaro">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="django, python, Programación, " />

<meta property="og:title" content="Django: enlaces en listado de objectos  - change_list "/>
<meta property="og:url" content="/enlaces-en-listado-de-objectos" />
<meta property="og:description" content="En mis proyectos suelo usar enlaces a elementos relacionados en el change_list del admin. utils.py Tengo esto en utils.py from django.contrib import admin from django.contrib.contenttypes.models import ContentType from django.core import urlresolvers from django.utils.datastructures import SortedDict from django.utils.functional import memoize ..." />
<meta property="og:site_name" content="Anotaciones por Pablo Caro" />
<meta property="og:article:author" content="Pablo Caro" />
<meta property="og:article:published_time" content="2014-05-21T10:42:00+02:00" />
<meta name="twitter:title" content="Django: enlaces en listado de objectos  - change_list ">
<meta name="twitter:description" content="En mis proyectos suelo usar enlaces a elementos relacionados en el change_list del admin. utils.py Tengo esto en utils.py from django.contrib import admin from django.contrib.contenttypes.models import ContentType from django.core import urlresolvers from django.utils.datastructures import SortedDict from django.utils.functional import memoize ...">
<meta property="og:image" content="/theme/images/apple-touch-icon-152x152.png" />
<meta name="twitter:image" content="/theme/images/apple-touch-icon-152x152.png" >

        <title>Django: enlaces en listado de objectos  - change_list  · Anotaciones por Pablo Caro
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
        <link rel="shortcut icon" href="/theme/images/favicon.ico" type="image/x-icon" type="image/png" />
        <link rel="icon" href="/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="/theme/images/apple-touch-icon-152x152.png" type="image/png" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name><span style="color:#AA1032;">Anotaciones</span> <span style="color:darkblue;">por</span> <span style="color:black">Pablo Caro</span></span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Inicio</a></li>
                            <li ><a href="/categories.html">Categorías</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archivos</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Búsqueda" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/enlaces-en-listado-de-objectos"> Django: enlaces en listado de&nbsp;objectos  <small> change_list </small>  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contenido</h4>
        <div class="contents topic" id="ficheros">
<p class="topic-title first">Ficheros</p>
<ul class="simple">
<li><a class="reference internal" href="#utils-py" id="id1">utils.py</a></li>
<li><a class="reference internal" href="#admin-py" id="id2">admin.py</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
            <p>En mis proyectos suelo usar enlaces a elementos relacionados en el change_list del admin.</p>

<div class="section" id="utils-py">
<h2><a class="toc-backref" href="#id1">utils.py</a></h2>
<p>Tengo esto en <code class="code">
utils.py</code>
</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">urlresolvers</span>
<span class="kn">from</span> <span class="nn">django.utils.datastructures</span> <span class="kn">import</span> <span class="n">SortedDict</span>
<span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">memoize</span>

<span class="k">def</span> <span class="nf">get_change_url</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">""" Utility method</span>
<span class="sd">        def server_link(self, obj):</span>
<span class="sd">             return self.get_change_url(obj.server)</span>
<span class="sd">        server_link.short_description = _('server')</span>
<span class="sd">        server_link.allow_tags = True</span>
<span class="sd">        server_link.admin_order_field = 'server__name'</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">get_content_type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>

    <span class="n">change_url</span> <span class="o">=</span> <span class="n">urlresolvers</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span>
        <span class="s">"</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_change"</span> <span class="o">%</span> <span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">app_name</span><span class="p">,</span> <span class="n">content_type</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">content_type</span><span class="o">.</span><span class="n">model</span><span class="p">),</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
    <span class="k">return</span> <span class="s">'&lt;a href="</span><span class="si">%s</span><span class="s">"&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;'</span> <span class="o">%</span> <span class="p">(</span><span class="n">change_url</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_content_type</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
<span class="n">get_content_type</span> <span class="o">=</span> <span class="n">memoize</span><span class="p">(</span><span class="n">_get_content_type</span><span class="p">,</span> <span class="n">SortedDict</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
<p>Hago uso de memoize para aumentar la eficiencia. Creo que es el punto junto entre simplicidad
en el código con facilidad de uso. He tenido también decoradores para repetir menos en el admin.py
pero cuando otros veían el código no lo entendían a la primera.</p>
</div>
<div class="section" id="admin-py">
<h2><a class="toc-backref" href="#id2">admin.py</a></h2>
<p>Un ejemplo de uso: en <code class="code">
admin.py</code>
 (suponiendo que el modelo Link tiene un <span class="caps">FK</span> llamado product):</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">get_change_url</span>

<span class="k">class</span> <span class="nc">LinkAdmin</span><span class="p">(</span><span class="n">AdminImageMixin</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'is_visible'</span><span class="p">,</span> <span class="s">'product_link'</span><span class="p">,</span> <span class="s">'updated_at'</span><span class="p">]</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">product_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_change_url</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">product</span><span class="p">)</span>
    <span class="n">product_link</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">'Product'</span>
    <span class="n">product_link</span><span class="o">.</span><span class="n">allow_tags</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">product_link</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s">'product__name'</span>
</pre></div>
</div>

            <section>
    <p id="post-share-links">
    ¿Te gustó esta anotación? Compártela en:
    <a href="http://twitter.com/home?status=Django%3A%20enlaces%20en%20listado%20de%C2%A0objectos%20change_list /enlaces-en-listado-de-objectos" target="_blank" title="Compartir en Twitter">Twitter</a>
    ❄
    <a href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=/enlaces-en-listado-de-objectos&p[images][0]=&p[title]=Django%3A%20enlaces%20en%20listado%20de%C2%A0objectos%20change_list&p[summary]=%3Cp%3EEn%20mis%20proyectos%20suelo%20usar%20enlaces%20a%20elementos%20relacionados%20en%20el%20change_list%20del%C2%A0admin.%3C/p%3E%0A%0A%3Cdiv%20class%3D%22section%22%20id%3D%22utils-py%22%3E%0A%3Ch2%3E%3Ca%20class%3D%22toc-backref%22%20href%3D%22%23id1%22%3Eutils.py%3C/a%3E%3C/h2%3E%0A%3Cp%3ETengo%20esto%20en%20%3Ccode%20class%3D%22code%22%3E%0Autils.py%3C/code%3E%0A%3C/p%3E%0A%3Cdiv%20class%3D%22highlight%22%3E%3Cpre%3E%3Cspan%20class%3D%22kn%22%3Efrom%3C/span%3E%20%3Cspan%20class%3D%22nn%22%3Edjango.contrib%3C/span%3E%20%3Cspan%20class%3D%22kn%22%3Eimport%3C/span%3E%20%3Cspan%20class%3D%22n%22%3Eadmin%3C/span%3E%0A%3Cspan%20class%3D%22kn%22%3Efrom%3C/span%3E%20%3Cspan%20class%3D%22nn%22%3Edjango.contrib.contenttypes.models%3C/span%3E%20%3Cspan%20class%3D%22kn%22%3Eimport%3C/span%3E%20%3Cspan%20class%3D%22n%22%3EContentType%3C/span%3E%0A%3Cspan%20class%3D%22kn%22%3Efrom%3C/span%3E%20%3Cspan%20class%3D%22nn%22%3Edjango.core%3C/span%3E%20%3Cspan%20class%3D%22kn%22%3Eimport%3C/span%3E%20%3Cspan%20class%3D%22n%22%3Eurlresolvers%3C/span%3E%0A%3Cspan%20class%3D%22kn%22%3Efrom%3C/span%3E%20%3Cspan%20class%3D%22nn%22%3Edjango.utils.datastructures%3C/span%3E%20%3Cspan%20class%3D%22kn%22%3Eimport%3C/span%3E%20%3Cspan%20class%3D%22n%22%3ESortedDict%3C/span%3E%0A%3Cspan%20class%3D%22kn%22%3Efrom%3C/span%3E%20%3Cspan%20class%3D%22nn%22%3Edjango.utils.functional%3C/span%3E%20%3Cspan%20class%3D%22kn%22%3Eimport%3C/span%3E%20%3Cspan%20class%3D%22n%22%3Ememoize%20...%3C/span%3E%3C/pre%3E%3C/div%3E%3C/div%3E" target="_blank" title="Compartir en Facebook">Facebook</a>
    ❄
    <a href="https://plus.google.com/share?url=/enlaces-en-listado-de-objectos" target="_blank" title="Compartir en Google Plus">Google+</a>
    ❄
    <a href="mailto:?subject=Django%3A%20enlaces%20en%20listado%20de%C2%A0objectos%20change_list&body=/enlaces-en-listado-de-objectos" target="_blank" title="Compartir vía correo electrónico">Email</a>
    </p>
</section>

            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Publicado</h4>
            <time pubdate="pubdate" datetime="2014-05-21T10:42:00+02:00">may 21, 2014</time>
            <h4>Categoría</h4>
            <a class="category-link" href="/categories.html#programacion-ref">Programación</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#django-ref">django
                    <span>4</span>
</a></li>
                <li><a href="/tags.html#python-ref">python
                    <span>14</span>
</a></li>
            </ul>
<h4>Contacta conmigo</h4>
    <a href="http://twitter.com/pcaro" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="http://github.com/pcaro" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="https://www.linkedin.com/in/pcarorevuelta" title="My Linkedin Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-linkedin sidebar-social-links"></i></a>
    <a href="https://www.facebook.com/pablo.carorevuelta" title="My Facebook Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-facebook sidebar-social-links"></i></a>
    <a href="mailto:correo@pablocaro.es" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name"><span style="color:#AA1032;">Anotaciones</span> <span style="color:darkblue;">por</span> <span style="color:black">Pablo Caro</span></span> - Anotaciones</li>
        <li class="elegant-license"><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"> Anotaciones</span> de <a xmlns:cc="http://creativecommons.org/ns#" href="http://pablocaro.es" property="cc:attributionName" rel="cc:attributionURL">Pablo Caro</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</li>
        <li class="elegant-power">Proporcionados por <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> por <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>